# Cookie & Session 

## HTTP 
> html 문서와 같은 리소스들을 가져올 수 있도록 해주는 규약 

특징
- 비연결 지향
    - 서버는 요청에 대한 응답을 보낸 후 연결을 끊음
- 무상태 
    - 연결을 끊는 순간 클라이언트와 서버 간의 통신이 끝나며 상태 정보가 유지되지 않음

## 쿠키 
> 서버가 사용자의 웹 브라우저에 전송하는 작은 데이터 조각

- 클라이언트 측에서 저장되는 작은 데이터 파일이며, 사용자 인증, 추적, 상태유지 등에 사용되는 데이터 저장 방법 
- 서버로부터 쿠키를 받고 같은 서버에 다른 페이지로 재요청시마다 저장해 놓았던 쿠키를 함께 전송

### 쿠키 사용 원리
- 브라우저는 쿠키를 KEY-VALUE 데이터 형식으로 저장
- 동일한 서버에 재요청시 저장되 쿠키를 함께 전송
- 상태가 없는 HTTP 프로토콜에서 상태 정보를 기억시켜줌

### 쿠키 사용 목적
1. 세션 관리
- 로그인, 아이디 자동완성, 공지 하루 안보기, 팝업 체크, 장바구니 등의 정보 관리
2. 개인화
- 사용자 선호, 테마 등의 설정
3. 트래킹
- 사용자 행동을 기록 및 분석

## 세션
> 서버측에서 생성되어 클라이언트와 서버 간의 상태를 유지, 상태 정보를 저장하는 데이터 저장 방식

- 쿠키에 세션 데이터를 저장하여 매 요청시마다 세션 데이터를 함께 보냄

### 세션의 작동원리
- 클라이언트가 로그인하면 서버가 세션 데이터를 생성 후 저장
- 생성된 세션 데이터에 인증할 수 있는 세션 id를 발급
- 발급한 세션 id를 클라이언트에게 응답
- 클라이언트는 응답 받은 세션 id를 쿠키에 저장
- 클라이언트가 다시 동일한 서버에 접속하면 요청과 함께 쿠키를 서버에 전달
- 쿠키는 요청 때마다 서버에 함께 전송되므로 서버에서 세션 id를 확인해 로그인 되어있다는 것을 알도록 함

### 쿠키와 세션의 목적
> 서버와 클라이언트간의 상태 유지

### 쿠키 종류별 lifetime
1. Session cookie
- 현재 세션이 종료되면 삭제
- 브라우저 종료와 함께 삭제
2. Persistent cookies
- Expires 속성에 지정된 날짜 혹은 Max-Age 속성에 지정된 기간이 지나면 삭제

### Session in Django
- django는 database-backed sessions 저장 방식을 기본 값으로 사용
- session 정보는 DB의 django_session 테이블에 저장됨
- Django는 요청안에 특정 session_id 를 포함하는 쿠키를 사용해서 각각의 브라우저와 사이트가 연결된 session 을 알아냄

## Django Authentication System
> 사용자 인증과 관련된 기능을 모아놓은 시스템

### User model 대체하기
> django가 기본적으로 제공하는 User model이 아닌 직접 작성한 User model을 사용하기 위해

### User 클래스 대체하는 이유
- 별도의 설정 없이 사용할 수 있어 간편하지만, 개발자가 직접 수정할 수 없는 문제가 존재

### AUTH_USER_MODEL
> django 프로젝트의 User를 나타내는 데 사용하는 모델을 지정

- 프로젝트 중간에 변경 불가
- 프로젝트를 시작하며 반드시 User 모델을 대체해야한다. 

## Login&Logout

### Login
> 세션을 create하는 과정

#### AuthenticaionForm()
> 로그인 인증에 사용할 데이터를 입력받는 built-in form

#### login(request, user)
> AuthenticationForm을 통해 인증된 사용자를 로그인하는 함수

#### get_user()
> AuthenticationForm의 인스턴스 메서드

### Logout
> 세션을 delete하는 과정

#### logout(request)
> 현재 요청에 대한 세션 data를 DB에서 삭제, 클라이언트의 쿠키에서도 세션 id를 삭제

### Abstract base classed (추상 기본 클래스)
- 몇가지 공통 정보를 여러 다른 모델에 넣을 때 사용하는 클래스
- 데이터베이스 테이블을 만드는 데 사용되지 않으며 대신 다른 모델의 기본 클래스로 사용되는 경우 해당 하위 클래스의 필드에 추가됨



